<!DOCTYPE html>
<html>
<head>
    <title>DDoS Attack Simulation</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #111; color: white; text-align: center; overflow: hidden; }
        h2 { margin-top: 10px; margin-bottom: 5px; }
        #canvas-container { position: relative; display: inline-block; box-shadow: 0 0 20px rgba(0, 255, 255, 0.2); border-radius: 8px; }
        canvas { background: #1e1e1e; border-radius: 8px; cursor: crosshair; }
        .controls { margin-top: 15px; display: flex; gap: 10px; justify-content: center; }
        button { padding: 10px 20px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        #btn-legit { background: #00c853; color: white; }
        #btn-attack { background: #d50000; color: white; }
        #btn-reset { background: #444; color: white; }
        button:hover { transform: scale(1.05); opacity: 0.9; }
        .stats { font-size: 14px; color: #aaa; margin-top: 5px; }
    </style>
</head>
<body>

    <h2>Traffic Control Center</h2>
    <div class="stats">Server Health: <span id="health-display">100%</span> | Packets in Queue: <span id="queue-display">0</span></div>
    
    <div id="canvas-container">
        <canvas id="simCanvas" width="600" height="400"></canvas>
    </div>

    <div class="controls">
        <button id="btn-legit" onclick="spawnLegitUser()">Add Legit User</button>
        <button id="btn-attack" onclick="toggleAttack()">Start DDoS Attack</button>
        <button id="btn-reset" onclick="resetSim()">Reset Server</button>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // Simulation State
        let server = { x: 300, y: 200, size: 40, health: 100, maxQueue: 50, queue: 0, color: '#00e676' };
        let attackers = [];
        let legitUsers = [];
        let packets = [];
        let attackActive = false;
        let attackInterval;

        function spawnLegitUser() {
            legitUsers.push({
                angle: Math.random() * Math.PI * 2,
                dist: 180,
                lastFire: 0
            });
        }

        function toggleAttack() {
            attackActive = !attackActive;
            document.getElementById('btn-attack').innerText = attackActive ? "Stop Attack" : "Start DDoS Attack";
            if (attackActive) {
                // Spawn a botnet
                for(let i=0; i<8; i++) {
                    attackers.push({ angle: (Math.PI * 2 / 8) * i, dist: 180 });
                }
            } else {
                attackers = [];
            }
        }

        function resetSim() {
            server.health = 100;
            server.queue = 0;
            server.color = '#00e676';
            attackers = [];
            legitUsers = [];
            packets = [];
            attackActive = false;
            document.getElementById('btn-attack').innerText = "Start DDoS Attack";
        }

        // Main Animation Loop
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. Draw Server
            ctx.fillStyle = server.color;
            ctx.shadowBlur = 15;
            ctx.shadowColor = server.color;
            ctx.fillRect(server.x - server.size/2, server.y - server.size/2, server.size, server.size);
            ctx.shadowBlur = 0;

            // Server Status Bar
            ctx.fillStyle = "#333";
            ctx.fillRect(server.x - 30, server.y + 30, 60, 6);
            ctx.fillStyle = server.health > 30 ? "#00e676" : "#d50000";
            ctx.fillRect(server.x - 30, server.y + 30, 60 * (server.health/100), 6);

            // 2. Logic: Spawning Packets
            const now = Date.now();
            
            // Legit users send packets occasionally
            legitUsers.forEach(u => {
                if (now - u.lastFire > 1000) { // 1 packet per second
                    packets.push({ x: 300 + Math.cos(u.angle)*u.dist, y: 200 + Math.sin(u.angle)*u.dist, type: 'legit', vx: 0, vy: 0 });
                    u.lastFire = now;
                }
                // Draw User
                ctx.fillStyle = "#00c853";
                ctx.beginPath();
                ctx.arc(300 + Math.cos(u.angle)*u.dist, 200 + Math.sin(u.angle)*u.dist, 8, 0, Math.PI*2);
                ctx.fill();
            });

            // Attackers send packets VERY fast
            if (attackActive) {
                attackers.forEach(a => {
                    if (Math.random() < 0.2) { // High frequency
                        packets.push({ x: 300 + Math.cos(a.angle)*a.dist, y: 200 + Math.sin(a.angle)*a.dist, type: 'attack', vx: 0, vy: 0 });
                    }
                    // Draw Bot
                    ctx.fillStyle = "#d50000";
                    ctx.beginPath();
                    ctx.arc(300 + Math.cos(a.angle)*a.dist, 200 + Math.sin(a.angle)*a.dist, 8, 0, Math.PI*2);
                    ctx.fill();
                });
            }

            // 3. Move Packets
            for (let i = packets.length - 1; i >= 0; i--) {
                let p = packets[i];
                let dx = server.x - p.x;
                let dy = server.y - p.y;
                let dist = Math.sqrt(dx*dx + dy*dy);
                
                p.x += (dx / dist) * 3; // Move speed
                p.y += (dy / dist) * 3;

                // Draw Packet
                ctx.fillStyle = p.type === 'legit' ? '#69f0ae' : '#ff5252';
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
                ctx.fill();

                // Hit Server
                if (dist < 20) {
                    packets.splice(i, 1);
                    if (server.health > 0) {
                        server.queue++;
                    }
                }
            }

            // 4. Server Processing (clears queue slowly)
            if (server.queue > 0 && Math.random() < 0.1) { // Server speed
                server.queue--;
            }

            // 5. Impact Logic
            // If queue is full, health drops
            if (server.queue > server.maxQueue) {
                server.queue = server.maxQueue; // Cap it
                server.health -= 0.5;
            } else {
                // Recover health slowly if not under heavy load
                if (server.health < 100 && server.queue < 10) server.health += 0.1;
            }

            // Visual Feedback on Crush
            if (server.health <= 0) {
                server.health = 0;
                server.color = '#444'; // Dead server
            } else if (server.queue > 30) {
                server.color = '#ff9100'; // Stressed
            } else {
                server.color = '#00e676'; // Healthy
            }

            // Update HTML text
            document.getElementById('health-display').innerText = Math.floor(server.health) + "%";
            document.getElementById('queue-display').innerText = server.queue;

            requestAnimationFrame(update);
        }
        
        // Start
        update();
    </script>
</body>
</html>
